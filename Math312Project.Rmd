---
title: "Math 312 Project"
author: "Alana Nadolski"
date: "2023-12-05"
output: html_document
---

```{r}
HeunSystemNATable<-function(Fxyt=function(x,y,t){},Gxyt=function(x,y,t){},x0,y0,a,b,n){
  x<-0
  y<-0
  t<-seq(a,b,by=(b-a)/(n-1))
  x[1]<-x0
  y[1]<-y0
  for(i in 2:n){
    x_temp<-x[i-1]+Fxyt(x[i-1],y[i-1],t[i-1])*(b-a)/(n-1)    
    y_temp<-y[i-1]+Gxyt(x[i-1],y[i-1],t[i-1])*(b-a)/(n-1)
    x[i]<-x[i-1]+(Fxyt(x[i-1],y[i-1],t[i-1])+Fxyt(x_temp,y_temp,t[i]))*(b-a)/(2*(n-1))    
    y[i]<-y[i-1]+(Gxyt(x[i-1],y[i-1],t[i-1])+Gxyt(x_temp,y_temp,t[i]))*(b-a)/(2*(n-1))
  }
  plot(x,y,col="red",pch=20,cex=1.5)
  points(x[1],y[1],col="blue",pch=20,cex=2.5)
  recordPlot()
  
  table<-data.frame(t,x,y)
  return(table)
}
```

```{r}
EulerSystemNATable<-function(Fxyt=function(x,y,t){},Gxyt=function(x,y,t){},x0,y0,a,b,n){
  x<-0
  y<-0
  t<-seq(a,b,by=(b-a)/(n-1))
  x[1]<-x0
  y[1]<-y0
  for(i in 2:n){
    x[i]<-x[i-1]+Fxyt(x[i-1],y[i-1],t[i-1])*(b-a)/(n-1)    
    y[i]<-y[i-1]+Gxyt(x[i-1],y[i-1],t[i-1])*(b-a)/(n-1)
  }
  
  plot(x,y,col="red",pch=20,cex=2.5)
  points(x[1],y[1],col="red",pch=20,cex=2.5)
  recordPlot()
  table<-data.frame(t,x,y)
  return(table)
}
```

```{r}
Fxyt <- function(x,y,t){y}
Gxyt <- function(x,y,t){-9.8*sin(x) - y + 0.5*sin(t)}
buttons <- list("Heun's Method", "Euler's Method")
```

```{r eval = FALSE}
library(shiny)
# Build the shiny server
server_methods <- function(input, output) {
  observeEvent(input$heun, {
    output$xy_plot <- renderPlot({HeunSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick, input$a_pick, input$b_pick,         (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)})
  
    output$xt_plot <- renderPlot(plot(HeunSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick, input$a_pick, input$b_pick,     (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)$t, HeunSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick,           input$a_pick, input$b_pick,  (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)$x, xlab = "t", ylab = "x"))

    output$yt_plot <- renderPlot(plot(HeunSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick, input$a_pick, input$b_pick,     (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)$t, HeunSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick,           input$a_pick, input$b_pick,  (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)$y, xlab = "t", ylab = "y"))
  })
    observeEvent(input$euler, {
    output$xy_plot <- renderPlot({EulerSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick, input$a_pick, input$b_pick,         (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)})
  
    output$xt_plot <- renderPlot(plot(EulerSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick, input$a_pick, input$b_pick,     (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)$t, EulerSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick,           input$a_pick, input$b_pick,  (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)$x, xlab = "t", ylab = "x"))

    output$yt_plot <- renderPlot(plot(EulerSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick, input$a_pick, input$b_pick,     (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)$t, EulerSystemNATable(Fxyt, Gxyt, input$x0_pick, input$y0_pick,           input$a_pick, input$b_pick,  (input$b_pick-input$a_pick) * (1/input$dt_pick) + 1)$y, xlab = "t", ylab = "y"))
  })
}

# Build the shiny user interface
ui_methods <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      h4("Select things:"),
      actionButton("heun", "Heun's Method"),
      actionButton("euler", "Euler's Method"), 
      numericInput("x0_pick", "Initial x value (x0)", value = 0, min = 0, max = 100),
      numericInput("y0_pick", "Initial y value (y0)", value = 0, min = 0, max = 100),
      numericInput("a_pick", "Start Time", value = 0, min = 0, max = 100),
      numericInput("b_pick", "End Time", value = 1, min = 0, max = 100, step = 0.1),
      numericInput("dt_pick", "Delta t (0<dt<=1)", value = 0.01, min = 0, max = 1),
    ),
    mainPanel(
      plotOutput("xy_plot"),
      plotOutput("xt_plot"),
      plotOutput("yt_plot")
    )
  )
)


# Run the shiny app! <- you'll see an error here but don't worry about it
shinyApp(ui = ui_methods, server = server_methods)
```


## The following function will perform Euler's Method on a scalar
## Non-Autonomous ODE (RHS depends on y and t)
## the function needs to be specified ahead of time as 
## Fy<-function(y,t){f}    where f is some function of y and t
## e.g. for f(y) = y^2 + sin(t)
## Fyt<-function(y,t){y^2 + sin(t)}
## Euler's Method starts at t=a and runs to t=b
## where y(a) = y0 and the step size is delta(t) = (b-a)/(n-1)
## Usage:  after Fyt has been specified run the command
## EulerTable<-EulerNATable(Fyt,y0,a,b,n)
## with appropriate values of y0, a, b, and n
## to see the table of approximate values of y run
## EulerTable in the console


```{r}
EulerNATable<-function(Fyt=function(y,t){},y0,a,b,n){
  y<-0
  t<-seq(a,b,by=(b-a)/(n-1))
  y[1]<-y0
  for(i in 2:n){
    y[i]<-y[i-1]+Fyt(y[i-1],t[i-1])*(b-a)/(n-1)
  }
  
  plot(t,y)
  points(t[1],y[1],col="red",pch=20,cex=2.5)
  recordPlot()
  table<-data.frame(t,y)
  return(table)
}

Fyt = function(y,t){y * (-y)}
```

```{r eval = FALSE}
library(shiny)
# Build the shiny server
server_Euler <- function(input, output) {
  output$model_plot <- renderPlot({
    EulerNATable(function(y,t){input$fyt}, input$y0_pick, input$a_pick, input$b_pick,  (input$b_pick-input$a_pick) * 100 + 1),
    
  })
}

# Build the shiny user interface
ui_Euler <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      h4("Select things:"), 
      textInput("fyt", "What is Fyt? (please use proper R syntax)"),
      numericInput("y0_pick", "Initial y value (y0)", value = 0, min = 0, max = 100),
      numericInput("a_pick", "Start Time", value = 0, min = 0, max = 100),
      numericInput("b_pick", "End Time", value = 1, min = 0, max = 100),
      
      
    ),
    mainPanel(
      plotOutput("model_plot")
    )
  )
)


# Run the shiny app!
shinyApp(ui = ui_Euler, server = server_Euler)
```











shiny app example:


```{r}
# Load packages
library(tidymodels)
library(tidyverse)

# Load & process data
# There are 9 types of land use. For now, we'll only consider 3.
# There are 147 possible predictors of land use. For now, we'll only consider 4.
land_3 <- read.csv("https://ajohns24.github.io/data/land_cover.csv") %>% 
  rename(type = class) %>% 
  filter(type %in% c("asphalt ","grass ","tree ")) %>% 
  mutate(type = as.factor(type)) %>% 
  select(type, NDVI, Mean_G, Bright_100, SD_NIR)
```

```{r}
# Define KNN plot
library(gridExtra)
library(FNN)
knnplot <- function(x1, x2, y, k, lab_1, lab_2){
 x1 <- (x1 - mean(x1)) / sd(x1)
 x2 <- (x2 - mean(x2)) / sd(x2)
 x1s <- seq(min(x1), max(x1), len = 100)
 x2s <- seq(min(x2), max(x2), len = 100) 
 testdata <- expand.grid(x1s,x2s)
 knnmod <- knn(train = data.frame(x1, x2), test = testdata, cl = y, k = k, prob = TRUE)
 testdata <- testdata %>% mutate(class = knnmod)
 g1 <- ggplot(testdata, aes(x = Var1, y = Var2, color = class)) + 
     geom_point() + 
     labs(x = paste(lab_1), y = paste(lab_2), title = "KNN classification regions") + 
     theme_minimal() +
     scale_color_manual(values = c("asphalt " = "black",
                            "grass " = "#E69F00",
                            "tree " = "#56B4E9")) 
 g2 <- ggplot(NULL, aes(x = x1, y = x2, color = y)) + 
     geom_point() + 
     labs(x = paste(lab_1), y = paste(lab_2), title = "Raw data") + 
     theme_minimal() +
     scale_color_manual(values = c("asphalt " = "black",
                            "grass " = "#E69F00",
                            "tree " = "#56B4E9")) 
 grid.arrange(g1, g2)
}
```

```{r eval = FALSE}
library(shiny)
# Build the shiny server
server_KNN <- function(input, output) {
  output$model_plot <- renderPlot({
    knnplot(x1 = land_3$Mean_G, x2 = land_3$NDVI, y = land_3$type, k = input$k_pick, lab_1 = "Mean_G (standardized)", lab_2 = "NDVI (standardized)")
  })
}

# Build the shiny user interface
ui_KNN <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      h4("Pick K:"), 
      sliderInput("k_pick", "K", min = 1, max = 277, value = 1)
    ),
    mainPanel(
      plotOutput("model_plot")
    )
  )
)


# Run the shiny app!
shinyApp(ui = ui_KNN, server = server_KNN)
```
